[ π“ ](./README-kr.md) [ [en](./AUTH_PROCESS.md) | kr ]

# Boho μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μΈμ¦ ν”„λ΅μ„Έμ¤

boho λΌμ΄λΈλ¬λ¦¬μ μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μΈμ¦(AUTH) ν”„λ΅μ„Έμ¤λ” λ‹¤μκ³Ό κ°™μ€ λ‹¨κ³„λ΅ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.

---

## 1. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: AUTH_REQ
- ν΄λΌμ΄μ–ΈνΈκ°€ μΈμ¦μ„ μ‹μ‘ν•κΈ° μ„ν•΄ `AUTH_REQ` λ©”μ‹μ§€λ¥Ό μ„λ²„λ΅ μ „μ†΅ν•©λ‹λ‹¤.
- λ©”μ‹μ§€ νƒ€μ…: `BohoMsg.AUTH_REQ`

## 2. μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: AUTH_NONCE
- μ„λ²„λ” ν„μ¬ μ‹κ°(μ΄/λ°€λ¦¬μ΄)κ³Ό λλ¤ nonceλ¥Ό ν¬ν•¨ν• `AUTH_NONCE` λ©”μ‹μ§€λ¥Ό ν΄λΌμ΄μ–ΈνΈμ— λ³΄λƒ…λ‹λ‹¤.
- λ©”μ‹μ§€ νƒ€μ…: `BohoMsg.AUTH_NONCE`
- λ‚΄μ©: unixTime, milTime, nonce

## 3. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: AUTH_HMAC
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° λ°›μ€ nonceμ™€ μ‹κ° μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ salt12λ¥Ό μƒμ„±ν•κ³ , μμ‹ μ λλ¤ nonceλ¥Ό μƒλ΅ λ§λ“­λ‹λ‹¤.
- salt12μ™€ μμ‹ μ nonceλ¥Ό ν•©μ³ HMACμ„ μƒμ„±ν• λ’¤, `AUTH_HMAC` λ©”μ‹μ§€λ΅ μ„λ²„μ— μ „μ†΅ν•©λ‹λ‹¤.
- λ©”μ‹μ§€ νƒ€μ…: `BohoMsg.AUTH_HMAC`
- λ‚΄μ©: id8, clientNonce, hmac32

## 4. μ„λ²„: AUTH_HMAC κ²€μ¦ λ° μ‘λ‹µ
- μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ HMACμ΄ μ¬λ°”λ¥Έμ§€ κ²€μ¦ν•©λ‹λ‹¤.
- κ²€μ¦ μ„±κ³µ μ‹, μ„λ²„λ” μμ‹ μ HMACμ„ μƒμ„±ν•μ—¬ `AUTH_ACK` λ©”μ‹μ§€λ΅ ν΄λΌμ΄μ–ΈνΈμ— μ‘λ‹µν•©λ‹λ‹¤.
- μ‹¤ν¨ μ‹, `AUTH_FAIL` λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό μ μμµλ‹λ‹¤.

## 5. ν΄λΌμ΄μ–ΈνΈ: AUTH_ACK κ²€μ¦
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ `AUTH_ACK` λ©”μ‹μ§€μ— ν¬ν•¨λ HMACμ΄ μ¬λ°”λ¥Έμ§€ κ²€μ¦ν•©λ‹λ‹¤.
- κ²€μ¦μ΄ μ„±κ³µν•λ©΄, μ–‘μ½ λ¨λ‘ `isAuthorized = true` μƒνƒκ°€ λμ–΄ μ΄ν›„ μ•”νΈν™” ν†µμ‹ μ΄ κ°€λ¥ν•©λ‹λ‹¤.

---

## λ©”μ‹μ§€ ν”λ΅μ° μ”μ•½

```mermaid
sequenceDiagram
    participant Client
    participant Server

    Client->>Server: AUTH_REQ
    Server->>Client: AUTH_NONCE (unixTime, milTime, nonce)
    Client->>Server: AUTH_HMAC (id8, clientNonce, hmac32)
    Server->>Client: AUTH_ACK (hmac32) / AUTH_FAIL
    Client->>Client: AUTH_ACK κ²€μ¦
```

---

## κ° λ‹¨κ³„μ λ©μ 

- **AUTH_REQ**: μΈμ¦ μ‹μ‘ μ‹ νΈ
- **AUTH_NONCE**: μ„λ²„κ°€ μ‹κ°„/nonceλ¥Ό μ κ³µν•μ—¬ λ¦¬ν”λ μ΄ κ³µκ²© λ°©μ§€
- **AUTH_HMAC**: ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ HMAC μƒμ„±(μ„λ²„κ°€ κ²€μ¦)
- **AUTH_ACK**: μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μΈμ¦ μ„±κ³µμ„ μ•λ¦¬κ³ , μ¶”κ°€ HMACμΌλ΅ μƒνΈ μΈμ¦
- **AUTH_FAIL**: μΈμ¦ μ‹¤ν¨ μ‹ μ„λ²„κ°€ μ „μ†΅

---

## νΉμ§• λ° λ³΄μ•μ„±

- μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘ λλ¤ nonceμ™€ μ‹κ° μ •λ³΄λ¥Ό μ‚¬μ©ν•μ—¬, λ¦¬ν”λ μ΄ κ³µκ²©μ— κ°•ν•¨
- HMAC κΈ°λ° μƒνΈ μΈμ¦μΌλ΅, ν‚¤λ¥Ό λ…Έμ¶ν•μ§€ μ•κ³  μΈμ¦ κ°€λ¥
- μΈμ¦μ΄ μ™„λ£λμ–΄μ•Όλ§ μ΄ν›„ μ•”νΈν™” ν†µμ‹ (ENC_488, ENC_PACK λ“±)μ΄ κ°€λ¥

---

bohoμ μΈμ¦ ν”„λ΅ν† μ½μ€ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ nonceμ™€ μ‹κ° μ •λ³΄λ¥Ό κµν™ν•κ³ , HMACμ„ ν†µν•΄ μƒνΈ μΈμ¦ν•λ” κµ¬μ΅°μ…λ‹λ‹¤. μ΄ κ³Όμ •μ„ ν†µν•΄ μ•μ „ν•κ² μ„Έμ…μ„ μ„¤μ •ν•κ³ , μ΄ν›„ μ•”νΈν™”λ λ°μ΄ν„° ν†µμ‹ μ΄ κ°€λ¥ν•©λ‹λ‹¤. 